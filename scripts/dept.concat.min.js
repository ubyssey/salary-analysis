//! d3.tip
//! Copyright (c) 2013 Justin Palmer
//! Tooltips for d3.js SVG visualizations
!function(a,b){"function"==typeof define&&define.amd?define(["d3"],b):a.d3.tip=b(a.d3)}(this,function(a){return function(){function b(a){u=o(a),v=u.createSVGPoint(),document.body.appendChild(t)}function c(){return"n"}function d(){return[0,0]}function e(){return" "}function f(){var a=p();return{top:a.n.y-t.offsetHeight,left:a.n.x-t.offsetWidth/2}}function g(){var a=p();return{top:a.s.y,left:a.s.x-t.offsetWidth/2}}function h(){var a=p();return{top:a.e.y-t.offsetHeight/2,left:a.e.x}}function i(){var a=p();return{top:a.w.y-t.offsetHeight/2,left:a.w.x-t.offsetWidth}}function j(){var a=p();return{top:a.nw.y-t.offsetHeight,left:a.nw.x-t.offsetWidth}}function k(){var a=p();return{top:a.ne.y-t.offsetHeight,left:a.ne.x}}function l(){var a=p();return{top:a.sw.y,left:a.sw.x-t.offsetWidth}}function m(){var a=p();return{top:a.se.y,left:a.e.x}}function n(){var b=a.select(document.createElement("div"));return b.style({position:"absolute",top:0,opacity:0,"pointer-events":"none","box-sizing":"border-box"}),b.node()}function o(a){return a=a.node(),"svg"===a.tagName.toLowerCase()?a:a.ownerSVGElement}function p(){var b=w||a.event.target,c={},d=b.getScreenCTM(),e=b.getBBox(),f=e.width,g=e.height,h=e.x,i=e.y;return v.x=h,v.y=i,c.nw=v.matrixTransform(d),v.x+=f,c.ne=v.matrixTransform(d),v.y+=g,c.se=v.matrixTransform(d),v.x-=f,c.sw=v.matrixTransform(d),v.y-=g/2,c.w=v.matrixTransform(d),v.x+=f,c.e=v.matrixTransform(d),v.x-=f/2,v.y-=g/2,c.n=v.matrixTransform(d),v.y+=g,c.s=v.matrixTransform(d),c}var q=c,r=d,s=e,t=n(),u=null,v=null,w=null;b.show=function(){var c=Array.prototype.slice.call(arguments);c[c.length-1]instanceof SVGElement&&(w=c.pop());var d,e=s.apply(this,c),f=r.apply(this,c),g=q.apply(this,c),h=a.select(t),i=y.length,j=document.documentElement.scrollTop||document.body.scrollTop,k=document.documentElement.scrollLeft||document.body.scrollLeft;for(h.html(e).style({opacity:1,"pointer-events":"all"});i--;)h.classed(y[i],!1);return d=x.get(g).apply(this),h.classed(g,!0).style({top:d.top+f[0]+j+"px",left:d.left+f[1]+k+"px"}),b},b.hide=function(){var c=a.select(t);return c.style({opacity:0,"pointer-events":"none"}),b},b.attr=function(c){if(arguments.length<2&&"string"==typeof c)return a.select(t).attr(c);var d=Array.prototype.slice.call(arguments);return a.selection.prototype.attr.apply(a.select(t),d),b},b.style=function(c){if(arguments.length<2&&"string"==typeof c)return a.select(t).style(c);var d=Array.prototype.slice.call(arguments);return a.selection.prototype.style.apply(a.select(t),d),b},b.direction=function(c){return arguments.length?(q=null==c?c:a.functor(c),b):q},b.offset=function(c){return arguments.length?(r=null==c?c:a.functor(c),b):r},b.html=function(c){return arguments.length?(s=null==c?c:a.functor(c),b):s};var x=a.map({n:f,s:g,e:h,w:i,nw:j,ne:k,sw:l,se:m}),y=x.keys();return b}});;


/*!
by Ben Cook / The Ubyssey
 */
(function(){var a,b,c,d,e,f,g={}.hasOwnProperty,h=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};c=!0,c||(console.log=function(){}),e=function(a){var b,c;return b={},c=function(){var a;return a=d3.selectAll(".dot").classed("searchresult",!1),0!==Object.keys(b).length?(a=a.filter(function(a,c){var d,e;for(d in b)if(g.call(b,d)&&(e=b[d],e&&!e(a,c)))return!1;return!0}),a.classed("searchresult",!0),console.log(a),a[0].length):void 0},a.faculty_filter=function(a){var d;return d=$(a.currentTarget).val().split("fac")[1],0===+d?delete b.fac:b.fac=function(a){return a.faculty_id===d},c()},a.campus_filter=function(a){var b,c;b=function(){var b,d,e,f;for(e=$(a.currentTarget).find("input:checked"),f=[],b=0,d=e.length;d>b;b++)c=e[b],f.push(c.name.split("-")[1]);return f}(),d3.selectAll(".dot").classed("hidden",!1).filter(function(a){var c;return a.campus&&(c=a.campus,h.call(b,c)<0)}).classed("hidden",!0)},a.text_search=function(a){var d;return"submit"===a.type&&a.preventDefault(),d=$(a.currentTarget).find(".searchbar").val(),d=d.trim().toLowerCase(),""===d?delete b.q:b.q=function(a){var b;return b=a.dept_name||a.faculty_name,-1<b.toLowerCase().indexOf(d)},c()},a}({}),b={},d=function(a,c,d){a(c,function(a,c){var e,f,g,h;for(h=b[d],f=0,g=h.length;g>f;f++)(e=h[f])(a,c)})},a=function(){return function(a){var d,e;return e=d3.format("$,.0f"),d=function(b,c){var d;return d=a["fmt_"+b],"$"===d?c.tickFormat(e):d?c.tickFormat(d):void 0},function(e){var f,g,h,i,j,k,l,m,n;null!=a.title&&$(e).append($("<h2/>").text(a.title)),null!=a.subtitle&&$(e).append($("<h3/>").text(a.subtitle)),g={top:20,right:20,bottom:30,left:50},j=$(e).width()-g.left-g.right,f=(a.height||500)-g.top-g.bottom,k=d3.scale.linear().range([0,j]),m=d3.scale.linear().range([f,0]),l=d3.svg.axis().scale(k).orient("bottom"),d("x",l),n=d3.svg.axis().scale(m).orient("left"),d("y",n),h=d3.select(e).append("svg").attr("width",j+g.left+g.right).attr("height",f+g.top+g.bottom).append("g").attr("transform","translate("+g.left+","+g.top+")"),i=d3.tip().attr("class","d3-tip").html(a.tip),h.call(i),b[a.src]=b[a.src]||[],b[a.src].push(function(b,d){var e,g,o,p;switch(a.processor&&(d=a.processor(d)),k.domain(d3.extent(d,a.d_x)),m.domain(d3.extent(d,a.d_y)),h.append("g").attr("class","x axis").attr("transform","translate(0,"+f+")").call(l).append("text").attr("class","label").attr("x",j).attr("y",-6).style("text-anchor","end").text(a.label_x),h.append("g").attr("class","y axis").call(n).append("text").attr("class","label").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(a.label_y),typeof a.d_r){case"function":g=d3.scale.linear().range([a.min_r||2.5,a.max_r||7]).domain(d3.extent(d,a.d_r)),p=function(b){return g(a.d_r(b))};break;case"number":p=function(){return a.d_r};break;default:p=3.5}a.reference_line&&h.append("path").datum(d3.extent(d,a.d_x)).attr("class","reference-line").attr("d",d3.svg.line().x(function(a){return k(a)}).y(function(a){return m(a)})),c&&d.sort(function(a,b){return a.faculty_name.localeCompare(b.faculty_name)}),e=h.selectAll(".dot").data(d).enter().append("circle").attr("class","dot").attr("r",p).attr("cx",function(b){return k(a.d_x(b))}).attr("cy",function(b){return m(a.d_y(b))}).on("mouseover",i.show).on("mouseout",i.hide),a.click&&e.on("click",a.click),c&&(o=function(a){var b,c,d=/ /g;return c=(a.dept_name||a.faculty_name).replace(d,"-"),b=a.faculty_name,""+b+"-dept-"+c},h.selectAll(".dot").attr("id",function(a){return o(a)}))})}}}(this),f=function(b){var d,e,f,g,h;return d="http://ubyssey.ca/salaries",g=function(a){var b;return b=""+a.dept_name,c&&(b+="<span> - ID#"+a.dept_id+"</span"),b},h=function(a){var b,c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],"NULL"!==b.avg_salary_m&&"NULL"!==b.avg_salary_f&&e.push(b);return e},e=function(a){return window.open(""+d+"/search/?department_id="+a.dept_id)},f=function(a){return window.open(""+d+"/search/?faculty_id="+a.faculty_id)},b.departments={gender_salary:a({src:"dept",d_x:function(a){return+a.avg_salary_m},d_y:function(a){return+a.avg_salary_f},d_r:function(a){return+a.num_employees},label_x:"MALE - Average Salary",label_y:"FEMALE - Average Salary",fmt_x:"$",fmt_y:"$",title:"Average Salary, Male vs Female (by Department)",subtitle:"Reference line shows equality. Points are scaled by department size.",processor:h,tip:g,click:e,reference_line:!0}),salary_expenses:a({src:"dept",d_x:function(a){return+a.avg_salary},d_y:function(a){return+a.avg_expenses},label_x:"Avg Salary",label_y:"Avg Expenses",fmt_x:"$",fmt_y:"$",title:"Avg Salary vs Expenses (by Department)",tip:g,click:e})},b.faculties={gender_salary:a({src:"fac",d_x:function(a){return+a.avg_salary_m},d_y:function(a){return+a.avg_salary_f},d_r:function(a){return+a.num_employees},min_r:4,max_r:9,label_x:"MALE - Average Salary",label_y:"FEMALE - Average Salary",fmt_x:"$",fmt_y:"$",title:"Average Salary, Male vs Female (by Faculty)",subtitle:"Reference line shows equality. Points are scaled by faculty size.",processor:h,height:300,tip:function(a){return a.dept_name=a.faculty_name,a.dept_id=a.faculty_id,g(a)},click:f,reference_line:!0})},b}({}),f.departments.gender_salary("#deptchart"),f.departments.salary_expenses("#expenseschart"),f.faculties.gender_salary("#facchart"),d(d3.csv,"../data/departments.csv","dept"),d(d3.csv,"../data/faculties.csv","fac"),d3.csv("../data/faculties_list.csv",function(a,b){var c,d,e,f;for(d=$("#facultyselector"),b.unshift({faculty_name:"(All Faculties)",faculty_id:0}),e=0,f=b.length;f>e;e++)c=b[e],$("<option/>").attr("value","fac"+c.faculty_id).text(c.faculty_name).appendTo(d)}),$("#chartsearchform").keyup(e.text_search).submit(e.text_search),$("#facultyselector").change(e.faculty_filter),$("#chartsearchform .campuses").change(e.campus_filter)}).call(this);